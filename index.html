<!doctype html>
<html lang="nb">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Breakout – Tippekupong for Bjørnar</title>
<style>
  :root{
    --bg:#0d1117; --panel:#161b22; --ink:#e6edf3; --muted:#9fb1d1; --line:#30363d;
    --pepsi:#1e2a78; --cola:#b30000; --accent:#2ea043;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font:15px/1.4 system-ui,Segoe UI,Roboto,Arial}
  body{overflow:hidden;padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom)}

  header{
    display:flex; align-items:center; justify-content:space-between; gap:16px;
    background:var(--panel); border-bottom:1px solid var(--line);
    padding:10px 12px; min-height:56px; position:relative; z-index:3;
  }
  h1{margin:0;font-size:16px}
  .hud{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .stat{background:#10151d;border:1px solid var(--line);padding:6px 10px;border-radius:10px;min-width:96px;text-align:center}
  .stat b{font-size:18px}
  .quick{display:flex; gap:8px; flex-wrap:wrap}
  .quick button{
    cursor:pointer; border:1px solid var(--line); background:#0f1622; color:var(--ink);
    padding:8px 10px; border-radius:10px; font-weight:700; min-width:90px
  }
  .quick .primary{background:#13253a}

  #stage{
    height:calc(100vh - (env(safe-area-inset-top) + env(safe-area-inset-bottom)) - 56px);
    display:flex; flex-direction:column; align-items:center; justify-content:flex-start; gap:10px;
    padding:8px 12px;
  }
  #canvasWrap{position:relative; transform-origin:top center;}
  canvas{display:block; background:linear-gradient(180deg,#0b1220,#0a0f18); border-radius:12px; border:1px solid #112}

  .toolbar{
    display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:wrap;
    background:#10151d; border:1px solid var(--line); border-radius:12px; padding:8px 10px; width:min(960px,100%);
    box-shadow:0 6px 24px rgba(0,0,0,0.25);
  }
  .toolbar .group{display:flex; gap:8px; flex-wrap:wrap}
  .toolbar button{
    cursor:pointer; border:1px solid var(--line); background:#0f1622; color:var(--ink);
    padding:9px 12px; border-radius:12px; font-weight:700; min-width:110px
  }
  .toolbar .primary{background:#13253a}
  .toolbar .accent{background:#0f2116; border-color:#1d3b1d}

  .msg{height:28px; display:flex; align-items:center; justify-content:center; font-weight:700}
  .msg .soda{padding:2px 8px; border-radius:999px; margin:0 4px; color:#fff}
  .soda.pepsi{background:var(--pepsi)} .soda.cola{background:var(--cola)}

  .sign{
    position:absolute; left:50%; top:46%;
    transform:translate(-50%,-50%) scale(0.9);
    background:rgba(16,21,29,0.95);
    border:2px solid var(--line); border-radius:14px;
    padding:10px 16px; font-weight:800; letter-spacing:0.2px; text-align:center; white-space:nowrap;
    box-shadow:0 8px 30px rgba(0,0,0,0.5); animation:pop 900ms ease forwards; pointer-events:none;
  }
  .sign small{display:block;font-size:12px;color:var(--muted);margin-top:2px}
  @keyframes pop{
    0%{opacity:0; transform:translate(-50%,-50%) scale(0.85)}
    15%{opacity:1; transform:translate(-50%,-50%) scale(1.0)}
    70%{opacity:1}
    100%{opacity:0; transform:translate(-50%,-58%) scale(0.96)}
  }

  .dock{
    position:fixed; left:0; right:0; bottom:0;
    background:rgba(16,21,29,0.96); border-top:1px solid var(--line);
    padding:10px 12px calc(10px + env(safe-area-inset-bottom));
    display:none; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap;
    box-shadow:0 -12px 28px rgba(0,0,0,0.35);
    z-index:4;
  }
  .dock button{min-width:42%; padding:12px 14px; font-size:16px}
  .dock .row{display:flex; gap:10px; width:100%; justify-content:space-between}
  .dock .row.full{justify-content:center}
  .dock .wide{flex:1}
  .dock .move{min-width:48%}
  @media (max-width: 900px){.toolbar{display:none}.dock{display:flex}}
</style>
</head>
<body>
<header>
  <h1>Breakout for Bjørnar</h1>
  <div class="hud">
    <div class="stat">Poeng<br><b id="score">0</b></div>
    <div class="stat">Level<br><b id="level">1</b></div>
    <div class="stat">Liv<br><b id="lives">3</b></div>
  </div>
  <div class="quick">
    <button id="hdrStart" class="primary">Start</button>
    <button id="hdrPause">Pause</button>
  </div>
</header>

<div id="stage" aria-live="polite">
  <div id="canvasWrap">
    <canvas id="game" width="800" height="520" aria-label="Breakout-brett"></canvas>
    <canvas id="ribbon" width="800" height="16" style="position:absolute;left:0;top:0;pointer-events:none"></canvas>
  </div>
  <div class="toolbar">
    <div class="group">
      <button id="btnStart" class="primary">Start / Restart</button>
      <button id="btnPause">Pause</button>
    </div>
    <div class="group">
      <button id="btnSound">Lyd: Av</button>
      <button id="btnSpeak" class="accent">Tale: På</button>
    </div>
    <div class="group">
      <button id="btnLeft">◀ Venstre</button>
      <button id="btnRight">Høyre ▶</button>
    </div>
  </div>
  <div id="feedback" class="msg"></div>
</div>

<div class="dock">
  <div class="row">
    <button id="mStart" class="primary wide">Start</button>
    <button id="mPause" class="wide">Pause</button>
  </div>
  <div class="row">
    <button id="mLeft" class="move">◀ Venstre</button>
    <button id="mRight" class="move">Høyre ▶</button>
  </div>
  <div class="row full">
    <button id="mSound">Lyd: Av</button>
    <button id="mSpeak" class="accent">Tale: På</button>
  </div>
</div>

<script>
(()=>{
  const SPILL=["Lotto","Vikinglotto","Nabolaget","Eurojackpot","Extra","Joker","Keno"];
  const PRAISE=[
    "Bra jobba, Bjørnar!","Nydelig kontroll, Bjørnar!","Perfekt timing, Bjørnar!","Sterkt spilt, Bjørnar!",
    "Is i magen, Bjørnar!","Du eier brettet, Bjørnar!","Herlig flyt, Bjørnar!","Knallbra fokus, Bjørnar!",
    "Kongejobb, Bjørnar!","Dette sitter, Bjørnar!"
  ];
  let praiseBag=shuffle([...PRAISE]);
  const nextPraise=()=> (praiseBag.length?praiseBag:(praiseBag=shuffle([...PRAISE]))).pop();

  const cvs=document.getElementById('game'),ctx=cvs.getContext('2d');
  const ribbon=document.getElementById('ribbon'),rctx=ribbon.getContext('2d');
  const wrap=document.getElementById('canvasWrap');
  const scoreEl=document.getElementById('score'),levelEl=document.getElementById('level'),livesEl=document.getElementById('lives');
  const feedback=document.getElementById('feedback');
  const hdrStart=hdrPause=document.getElementById('hdrStart');
  const hdrPauseBtn=document.getElementById('hdrPause');
  const btnStart=document.getElementById('btnStart'),btnPause=document.getElementById('btnPause'),
        btnSound=document.getElementById('btnSound'),btnSpeak=document.getElementById('btnSpeak'),
        btnLeft=document.getElementById('btnLeft'),btnRight=document.getElementById('btnRight');
  const mStart=document.getElementById('mStart'),mPause=document.getElementById('mPause'),
        mSound=document.getElementById('mSound'),mSpeak=document.getElementById('mSpeak'),
        mLeft=document.getElementById('mLeft'),mRight=document.getElementById('mRight');
  const BASE_W=800,BASE_H=520;

  let audioCtx,soundOn=false,speakOn=true;
  function tone(f=880,d=0.06){if(!soundOn)return;if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type='square';o.frequency.value=f;g.gain.value=0.07;
    o.connect(g);g.connect(audioCtx.destination);o.start();setTimeout(()=>o.stop(),d*1000);}
  function say(t){if(!speakOn||!('speechSynthesis'in window))return;const u=new SpeechSynthesisUtterance(t);
    u.lang='nb-NO';u.rate=1.02;u.pitch=1.0;window.speechSynthesis.speak(u);}
  function showSign(main,sub=""){const e=document.createElement('div');e.className='sign';e.innerHTML=main+(sub?`<small>${sub}</small>`:"");
    wrap.appendChild(e);setTimeout(()=>e.remove(),950);}

  let score=0,lives=3,level=1,paused=false,running=false;
  const paddle={w:110,h:14,x:(BASE_W-110)/2,y:BASE_H-30,vx:0};
  const keys={left:false,right:false};
  const ball={x:BASE_W/2,y:BASE_H-60,r:8,dx:4,dy:-4,speedMul:1};
  let rows=5,cols=10,gap=6,brickH=22,bricks=[],colors=["#58a6ff","#39d353","#ff7b72","#d2a8ff","#f2cc60","#8b949e","#7ee787"];
  let lastCheer=0;const CHEER_INTERVAL=5500;

  function resetBall(){ball.x=paddle.x+paddle.w/2;ball.y=paddle.y-12;
    const ang=(Math.random()*0.6+0.2)*Math.PI,s=5+level*0.5;
    ball.dx=Math.cos(ang)*(Math.random()<0.5?-s:s);ball.dy=-Math.abs(Math.sin(ang)*s);}
  function buildBricks(){bricks=[];const totalGapX=(cols+1)*gap,bw=Math.floor((BASE_W-totalGapX)/cols),top=80;let i=0;
    for(let r=0;r<rows;r++)for(let c=0;c<cols;c++){const x=gap+c*(bw+gap),y=top+r*(brickH+gap),label=SPILL[i%SPILL.length];i++;
      bricks.push({x,y,w:bw,h:brickH,alive:true,color:colors[r%colors.length],label});}}
  function roundRect(c,x,y,w,h,r,f=1){c.beginPath();c.moveTo(x+r,y);c.arcTo(x+w,y,x+w,y+h,r);c.arcTo(x+w,y+h,x,y+h,r);
    c.arcTo(x,y+h,x,y,r);c.arcTo(x,y,x+w,y,r);if(f)c.fill();}
  function drawRibbon(){rctx.clearRect(0,0,BASE_W,16);rctx.fillStyle="#1e2a78";rctx.fillRect(0,0,BASE_W,8);
    rctx.fillStyle="#b30000";rctx.fillRect(0,8,BASE_W,8);}
  function draw(){ctx.clearRect(0,0,BASE_W,BASE_H);
    ctx.font="12px system-ui";ctx.textAlign="center";ctx.textBaseline="middle";
    bricks.forEach(b=>{if(!b.alive)return;ctx.fillStyle=b.color;roundRect(ctx,b.x,b.y,b.w,b.h,6);
      ctx.fillStyle="#0b1020";ctx.fillText(b.label,b.x+b.w/2,b.y+b.h/2);});
    ctx.fillStyle="#0ef";roundRect(ctx,paddle.x,paddle.y,paddle.w,paddle.h,8);
    const g=ctx.createRadialGradient(ball.x-3,ball.y-3,2,ball.x,ball.y,12);
    g.addColorStop(0,"#fff");g.addColorStop(1,"#58a6ff");
    ctx.fillStyle=g;ctx.beginPath();ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);ctx.fill();}

  function update(now,dt){
    if(paused||!running)return;
    if(!lastCheer)lastCheer=now;
    if(now-lastCheer>=CHEER_INTERVAL){const line=nextPraise();say(line);showSign(line);lastCheer=now;}

    // --- ny, mer responsiv bevegelse ---
    const ACC=2800,FRI=3600,MAX=820;
    if(keys.left)paddle.vx-=ACC*dt;
    if(keys.right)paddle.vx+=ACC*dt;
    if(!keys.left&&!keys.right){
      if(paddle.vx>0)paddle.vx=Math.max(0,paddle.vx-FRI*dt);
      else if(paddle.vx<0)paddle.vx=Math.min(0,paddle.vx+FRI*dt);
    }
    if(Math.abs(paddle.vx)<40)paddle.vx=0;
    paddle.vx=Math.max(-MAX,Math.min(MAX,paddle.vx));
    paddle.x+=paddle.vx*dt;
    if(paddle.x<0){paddle.x=0;paddle.vx=0;}
    if(paddle.x>BASE_W-paddle.w){paddle.x=BASE_W-paddle.w;paddle.vx=0;}

    ball.x+=ball.dx*ball.speedMul;ball.y+=ball.dy*ball.speedMul;
    if(ball.x-ball.r<0){ball.x=ball.r;ball.dx*=-1;tone(500);}
    if(ball.x+ball.r>BASE_W){ball.x=BASE_W-ball.r;ball.dx*=-1;tone(520);}
    if(ball.y-ball.r<0){ball.y=ball.r;ball.dy*=-1;tone(540);}

    if(ball.y+ball.r>=paddle.y&&ball.y+ball.r<=paddle.y+paddle.h&&ball.x>=paddle.x&&ball.x<=paddle.x+paddle.w&&ball.dy>0){
      const hit=(ball.x-(paddle.x+paddle.w/2))/(paddle.w/2);
      const speed=Math.hypot(ball.dx,ball.dy)*1.02;
      const ang=hit*(Math.PI/3);
      ball.dx=speed*Math.sin(ang);ball.dy=-Math.abs(speed*Math.cos(ang));
      tone(800,0.05);
      if(Math.random()<0.25){const l=nextPraise();say(l);showSign(l);lastCheer=now;}
    }

    for(const b of bricks){
      if(!b.alive)continue;
      if(ball.x>b.x&&ball.x<b.x+b.w&&ball.y>b.y&&ball.y<b.y+b.h){
        b.alive=false;score+=10;scoreEl.textContent=score;ball.dy*=-1;tone(900,0.06);
        say(b.label);feedback.innerHTML=spice(`${b.label}!`);
        if(Math.random()<0.7){const l=nextPraise();setTimeout(()=>{say(l);showSign(l,"Fortsatt flyt!");},220);lastCheer=now+220;}
        break;
      }
    }

    if(ball.y-ball.r>BASE_H){
      lives--;livesEl.textContent=lives;tone(200,0.2);
      if(lives<=0){feedback.innerHTML=spice("Game over – prøv igjen!");
        say("Ny runde, Bjørnar – dette tar du!");showSign("Game over","Trykk Start for ny runde");running=false;}
      else{
